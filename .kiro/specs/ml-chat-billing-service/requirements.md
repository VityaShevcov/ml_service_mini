# Требования к проекту

## Введение

ML-сервис с подсистемой биллинга представляет собой чат-интерфейс на базе Gradio, который предоставляет доступ к двум локальным ML-моделям (мини и про версии) с системой учета кредитов. Сервис должен обеспечивать аутентификацию пользователей, управление балансом кредитов и мониторинг использования моделей.

## Требования

### Требование 1

**Пользовательская история:** Как пользователь, я хочу зарегистрироваться в системе и управлять своим аккаунтом, чтобы получить доступ к ML-моделям и отслеживать свой баланс кредитов.

#### Критерии приемки

1. КОГДА пользователь открывает приложение ТОГДА система ДОЛЖНА отображать форму входа/регистрации
2. КОГДА пользователь заполняет форму регистрации корректными данными ТОГДА система ДОЛЖНА создать новый аккаунт с начальным балансом кредитов
3. КОГДА пользователь вводит корректные учетные данные ТОГДА система ДОЛЖНА аутентифицировать пользователя и предоставить доступ к чату
4. КОГДА пользователь аутентифицирован ТОГДА система ДОЛЖНА отображать текущий баланс кредитов в интерфейсе

### Требование 2

**Пользовательская история:** Как пользователь, я хочу взаимодействовать с двумя различными ML-моделями (Gemma3 1B и Gemma3 12B) через чат-интерфейс, чтобы получать предсказания разного качества и стоимости.

#### Критерии приемки

1. КОГДА пользователь аутентифицирован ТОГДА система ДОЛЖНА отображать чат-интерфейс с возможностью выбора модели (Gemma3 1B или Gemma3 12B)
2. КОГДА пользователь отправляет сообщение с выбранной моделью ТОГДА система ДОЛЖНА обработать запрос соответствующей ML-моделью
3. КОГДА модель обрабатывает запрос ТОГДА система ДОЛЖНА отобразить ответ в чате с указанием использованной модели
4. ЕСЛИ у пользователя недостаточно кредитов ТОГДА система ДОЛЖНА отклонить запрос и уведомить об этом
5. КОГДА система загружает модели ТОГДА Gemma3 12B ДОЛЖНА использовать квантизацию для оптимизации использования памяти

### Требование 3

**Пользовательская история:** Как пользователь, я хочу, чтобы с моего счета списывались кредиты за успешные предсказания, чтобы система могла контролировать использование ресурсов.

#### Критерии приемки

1. КОГДА ML-модель успешно выполняет предсказание ТОГДА система ДОЛЖНА списать соответствующее количество кредитов с баланса пользователя
2. КОГДА Gemma3 1B выполняет предсказание ТОГДА система ДОЛЖНА списать 1 кредит
3. КОГДА Gemma3 12B выполняет предсказание ТОГДА система ДОЛЖНА списать 3 кредита
4. КОГДА происходит списание кредитов ТОГДА система ДОЛЖНА обновить отображаемый баланс в реальном времени
5. ЕСЛИ обработка запроса завершается ошибкой ТОГДА система НЕ ДОЛЖНА списывать кредиты

### Требование 4

**Пользовательская история:** Как администратор, я хочу иметь возможность мониторинга использования системы и аналитики, чтобы отслеживать активность пользователей и производительность моделей.

#### Критерии приемки

1. КОГДА происходит взаимодействие с моделью ТОГДА система ДОЛЖНА логировать запрос, ответ, использованную модель и потраченные кредиты
2. КОГДА администратор запрашивает статистику ТОГДА система ДОЛЖНА предоставить отчет о количестве запросов по моделям
3. КОГДА администратор запрашивает статистику ТОГДА система ДОЛЖНА предоставить информацию о потраченных кредитах по пользователям
4. КОГДА происходит ошибка в системе ТОГДА система ДОЛЖНА логировать детали ошибки для диагностики

### Требование 5

**Пользовательская история:** Как пользователь, я хочу пополнять свой баланс кредитов, чтобы продолжать использовать ML-модели.

#### Критерии приемки

1. КОГДА пользователь аутентифицирован ТОГДА система ДОЛЖНА предоставить интерфейс для пополнения баланса
2. КОГДА пользователь указывает количество кредитов для пополнения ТОГДА система ДОЛЖНА добавить их к текущему балансу
3. КОГДА баланс пополняется ТОГДА система ДОЛЖНА логировать транзакцию пополнения
4. КОГДА баланс изменяется ТОГДА система ДОЛЖНА немедленно обновить отображение в интерфейсе

### Требование 6

**Пользовательская история:** Как разработчик, я хочу, чтобы система имела надежную архитектуру с базой данных, чтобы обеспечить сохранность пользовательских данных и истории транзакций.

#### Критерии приемки

1. КОГДА система запускается ТОГДА она ДОЛЖНА подключиться к базе данных SQLite
2. КОГДА создается новый пользователь ТОГДА система ДОЛЖНА сохранить данные пользователя в базе данных
3. КОГДА происходит транзакция с кредитами ТОГДА система ДОЛЖНА сохранить запись о транзакции в базе данных
4. КОГДА происходит взаимодействие с моделью ТОГДА система ДОЛЖНА сохранить лог взаимодействия в базе данных
5. ЕСЛИ происходит сбой системы ТОГДА данные пользователей и транзакций ДОЛЖНЫ остаться целыми в базе данных

### Требование 7

**Пользовательская история:** Как пользователь, я хочу видеть историю своих взаимодействий с моделями, чтобы отслеживать свою активность и расходы.

#### Критерии приемки

1. КОГДА пользователь аутентифицирован ТОГДА система ДОЛЖНА предоставить доступ к истории взаимодействий
2. КОГДА пользователь просматривает историю ТОГДА система ДОЛЖНА отображать дату, время, использованную модель и потраченные кредиты
3. КОГДА пользователь просматривает историю ТОГДА система ДОЛЖНА показывать текст запроса и полученный ответ
4. КОГДА история содержит много записей ТОГДА система ДОЛЖНА обеспечить пагинацию для удобного просмотра

### Требование 8

**Пользовательская история:** Как системный администратор, я хочу, чтобы система эффективно управляла ресурсами при работе с моделями разного размера, чтобы обеспечить стабильную работу в условиях ограниченной памяти.

#### Критерии приемки

1. КОГДА система инициализируется ТОГДА она ДОЛЖНА загрузить Gemma3 1B модель в память
2. КОГДА система инициализируется ТОГДА она ДОЛЖНА загрузить Gemma3 12B модель с квантизацией int8
3. КОГДА пользователь переключается между моделями ТОГДА система ДОЛЖНА эффективно управлять памятью без перезагрузки
4. ЕСЛИ доступной памяти недостаточно для Gemma3 12B ТОГДА система ДОЛЖНА уведомить об ошибке и предложить использовать только Gemma3 1B
5. КОГДА модель генерирует ответ ТОГДА система ДОЛЖНА ограничить максимальную длину ответа для предотвращения чрезмерного использования ресурсов